# üçÅ –ò–Ω—Å—Ç–∞–ª–ª—è—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è log —Ñ–∞–π–ª–æ–≤ PostgreSQL

## –û–ø–∏—Å–∞–Ω–∏–µ

[Systemd](https://en.wikipedia.org/wiki/Systemd) —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏:
1. —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π
1. —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã –Ω—É–ª–µ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–∞—Ä—à–µ K –¥–Ω–µ–π
1. –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç –Ω–µ—Å–∂–∞—Ç—ã–µ —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ –ú –¥–Ω–µ–π

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ (—Å–∂–∞—Ç–∏—è) —Ñ–∞–π–ª–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ —Å —Å–∞–º—ã–º –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (–¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∏—Å–∫–æ–≤ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â—É—é –°–£–ë–î).

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ –æ–±—ã—á–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –∏ –Ω–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ. –ó–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∂–∏–º–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∏–ª—å–Ω–µ–µ, –Ω–æ –Ω–µ –ø–æ—Ç—Ä–µ–±–ª—è—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU, –ø–∞–º—è—Ç—å). –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Å—Ç–µ–ø–µ–Ω—å —Å–∂–∞—Ç–∏—è –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–∂–∞—Ç–∏—è –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ (–º–æ–∂–Ω–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å).

## –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è

```ini
log_destination = 'csvlog' #–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
log_directory = '/var/log/postgresql/16' #–¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏, –ø–∞–ø–∫—É /var/log –ª—É—á—à–µ —Å–¥–µ–ª–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ –§–° —Å –∫–≤–æ—Ç–æ–π —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
log_filename = 'postgresql-%Y-%m-%d.log'
```

## –ò–Ω—Å—Ç–∞–ª–ª—è—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä—ã
sudo dnf -y install zstd xz bzip3

# —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª—ã
sudo nano /etc/systemd/system/pg_archive_log.timer && \
sudo nano /etc/systemd/system/pg_archive_log.service
 
# –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É
sudo systemctl daemon-reload  && \
sudo systemctl enable pg_archive_log.timer && \
sudo systemctl enable pg_archive_log
 
# –∑–∞–ø—É—Å–∫–∞–µ–º
sudo systemctl start pg_archive_log.timer && \
sudo systemctl start pg_archive_log
 
# –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
sudo systemctl status pg_archive_log.timer && \
sudo systemctl status pg_archive_log
 
# –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤, –¥.–±. —É–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞-–≤—Ä–µ–º—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞!
systemctl list-timers | grep -P 'NEXT|pg_archive_log'
```

**–§–∞–π–ª—ã**
1. [`/etc/systemd/system/pg_archive_log.timer`](pg_archive_log.timer)
2. [`/etc/systemd/system/pg_archive_log.service`](pg_archive_log.service)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∂–∞—Ç–∏—è –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏

–î–ª—è –∑–∞–º–µ—Ä–æ–≤ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –∫–æ–º–∞–Ω–¥–∞ `/usr/bin/time -v COMMAND`.\
–°–∂–∞—Ç–∏–µ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ –≤ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫. –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –≤ `/dev/null`.

–•–æ—Å—Ç `sc-inf-db-te12`, —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª: `postgresql-2025-09-14.csv` **186,311,281 –±–∞–π—Ç**.

| Program and compression level | Compression size (bytes)	| Compression size (%)	| Compression duration (s)	| Compression memory (KB)	| Decompression duration (s)	| Decompression memory (KB)	| Rating place |
| :--- | ---:	| ---:	| ---:	| ---:	| ---:	| ---:	| ---: |
| `gzip -9`	   | $\color{#f00}{3,453,449}$	| $\color{#f00}{144\\%}$	| $\color{#090}{1.24}$	 | $\color{#090}{2,416}$	  | $\color{#090}{0.46}$	| $\color{#090}{2,408}$	  | ‚Äî |
| `zstd -9`	   | $\color{#f00}{2,381,965}$	| 100%	                  | $\color{#090}{1.55}$	 | $\color{#090}{41,580}$	 | $\color{#090}{0.04}$	| $\color{#090}{4,220}$	  | 5 |
| `zstd -14`   | $\color{#f00}{2,449,812}$	| $\color{#f00}{103\\%}$	| $\color{#090}{2.61}$	 | 117,560	                | $\color{#090}{0.04}$	| $\color{#090}{6,436}$	  | ‚Äî |
| `zstd -19`   | 1,760,829	                | 74% 	                  | $\color{#f00}{77.40}$	| $\color{#f00}{216,512}$	| $\color{#090}{0.08}$	| $\color{#090}{10,444}$	 | ‚Äî |
| `bzip2 -9`   | 2,138,384	                | 90%	                   | $\color{#f00}{37.70}$	| $\color{#090}{7,944}$	  | $\color{#f00}{3.34}$	| $\color{#090}{5,032}$	  | ‚Äî |
| `bzip3 -b8`  | $\color{#090}{1,509,780}$	| $\color{#090}{63\\%}$	 | $\color{#090}{2.76}$	 | $\color{#090}{21,212}$	 | 1.99	                | $\color{#090}{52,428}$	 | 1 |
| `bzip3 -b16` | $\color{#090}{1,471,514}$	| $\color{#090}{62\\%}$	 | $\color{#090}{2.71}$	 | $\color{#090}{39,424}$	 | 1.91	                | 101,636	                | 2 |
| `bzip3 -b64` | $\color{#090}{1,412,929}$	| $\color{#090}{59\\%}$	 | $\color{#090}{2.98}$	 | $\color{#f00}{149,040}$	| 2.12	                | $\color{#f00}{396,484}$	| ‚Äî |
| `xz -2`      | 2,085,424	                | 85%	                   | $\color{#090}{2.6}$   | $\color{#090}{17,684}$	 | $\color{#090}{0.34}$ | $\color{#090}{4,720}$   | 3 |
| `xz -4`      | 2,233,640	                | 91%	                   | $\color{#f00}{7.20}$	 | $\color{#090}{46,392}$	 | $\color{#090}{0.33}$	| $\color{#090}{6,584}$	  | 4 |
| `xz -9`      | 2,057,736	                | 86%	                   | $\color{#f00}{18.34}$	| $\color{#f00}{629,832}$	| $\color{#090}{0.38}$	| $\color{#090}{16,510}$	 | ‚Äî |

–•–æ—Å—Ç `sc-ek-db-pr33`, —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª: `postgresql-2025-09-16.csv` **12,670,480 –±–∞–π—Ç**.

| Program and compression level | Compression size (bytes)	| Compression size (%)	| Compression duration (s)	| Compression memory (KB)	| Decompression duration (s)	| Decompression memory (KB)	| Rating place |
| :--- | ---:	| ---:	| ---:	| ---:	| ---:	| ---:	| ---: |
| `zstd -9`	   | 1,535,399	| 100%	| $\color{#090}{0.31}$	| 22,576	 | 0.01	| 4,600	  | 5 |
| `zstd -14`	  | 1,486,106	| 98%  | 1.02	| 65,632	 | 0.02	| 6,656	  | ‚Äî |
| `zstd -19`   | $\color{#090}{1,121,678}$	| 73%	 | $\color{#f00}{6.25}$	| 98,844	 | 0.02	| 10,768	 | ‚Äî |
| `bzip3 -b8`	 | 1,421,130	| 93%		| 1.00	| 35,944	 | 0.94	| 52,200	 | 1 |
| `bzip3 -b16`	| 1,368,821	| 89%		| 1.08	| 54,104	 | 0.84	| 92,912	 | 2 |
| `bzip3 -b32`	| 1,368,821	| 89%		| 1.07	| 53,340	 | 0.85	| $\color{#f00}{158,436}$	| ‚Äî |
| `xz -2`	     | 1,456,844	| 95%		| 0.92	| 18,696	 | 0.13	| 4,468	  | 3 |
| `xz -3`	     | 1,438,932	| 94%		| 1.66	| 34,164	 | 0.11	| 6,544	  | ‚Äî |
| `xz -4`	     | $\color{#090}{1,096,736}$	| 71%		| $\color{#f00}{2.75}$	| 50,624	 | 0.13	| 6,556	  | 4 |
| `xz -9`	     | $\color{#090}{924,236}$	  | 60%		| $\color{#f00}{4.24}$	| $\color{#f00}{163,292}$	| 0.11	| 14,776	 | ‚Äî |

### –í–µ—Ä—Å–∏–∏ –ü–û

| Program	| Version | –î–ª—è –∫–∞–∫–∏—Ö —Ü–µ–ª–µ–π –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç (PostgreSQL) | –ü–æ—á–µ–º—É –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç | 
| :---	| :--- | :--- | :--- |
| [zstd](https://github.com/facebook/zstd)	 | 1.4.4 | –°–∂–∞—Ç–∏–µ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –∏ WAL —Ñ–∞–π–ª–æ–≤ | –í–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∂–∞—Ç–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö –°–£–ë–î. –ï—â—ë –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ RTO. |
| bzip2	                                    | 1.0.6 | ‚Äî | |
| [bzip3](https://github.com/iczelia/bzip3)	| 1.3.1 | –°–∂–∞—Ç–∏–µ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ log —Ñ–∞–π–ª–æ–≤ | –§–∞–π–ª—ã –∑–∞ –∫–∞–∂–¥—ã–µ —Å—É—Ç–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–±–æ–ª—å—à–∏–µ, –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –°—Ç–µ–ø–µ–Ω—å —Å–∂–∞—Ç–∏—è –Ω–µ–º–Ω–æ–≥–æ –≤–∞–∂–Ω–µ–µ, —á–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∂–∞—Ç–∏—è –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏. |
| xz, liblzma	                              | 5.2.4 | ‚Äî | |
